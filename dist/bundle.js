/*
Lime version 0.1.0
Mathematics computation engine
2021 Lime Project Team, MIT license
https://github.com/onenylxus/lime
*/

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Lime=t()}(this,function(){"use strict";var r={github:"Please create a GitHub issue about how you received this message, thank you. ","error:functionAgreement":"Function does not agree with parameter types.","error:inputEmpty":"Prompt input is empty.","error:inputNotString":"Prompt input is not a string.","error:invalidSymbol":"Invalid symbol in prompt input.","issue:invalidExpressionInPrint":"Invalid expression in print process.","issue:invalidFunctionOrder":"Invalid function order.","issue:invalidMessage":"Invalid message detected.","issue:invalidModuleInBuild":"Invalid module in build process.","issue:invalidTokenInParse":"Invalid token in parse process."},i={"+":["add","b"],"*":["multiply","b"],"-":["subtract","b"]};var t={testMode:!1},n=class{static isUndefined(...e){return e.every(e=>void 0===e)}static isNull(...e){return e.every(e=>null===e)}static isTrue(...e){return e.every(e=>!0===e)}static isFalse(...e){return e.every(e=>!1===e)}static isBoolean(...e){return e.every(e=>"boolean"==typeof e)}static isNumber(...e){return e.every(e=>"number"==typeof e)}static isString(...e){return e.every(e=>"string"==typeof e)}static isFunction(...e){return e.every(e=>"function"==typeof e)}static isArray(...e){return e.every(e=>e instanceof Array)}static isObject(...e){return e.every(e=>e instanceof Object)}static isClass(t,...e){return e.every(e=>e instanceof t)}};var e=class{constructor(e,{...t}){this.lime=e,this.isSimple=!t.hasOwnProperty("isSimple")||!n.isBoolean(t.isSimple)||t.isSimple}};class s extends e{constructor(e,t){super(e,{isSimple:!0}),this.value=n.isNumber(+t)?Math.trunc(+t):null}}var a=[["add","subtract"],["multiply"]],o={cond:{"b(int,int)":e=>e.bpi("integer")},act:{},pair:{}};var l=class{constructor(e,{...t}){this.lime=e,this.mode=t.hasOwnProperty("mode")&&["l","r","b","n"].includes(t.mode)?t.mode:"x",this.name=(t.hasOwnProperty("name")?t.name:this.constructor.name.slice(4)).toLowerCase(),this.operations={l:[],r:[],b:[],n:[]},this.algorithms=new Map}get order(){for(let e=0;e<a.length;e++)if(a[e].includes(this.name))return e;throw new Error("issue:invalidFunctionOrder")}evaluate(i){const r=this.operations[this.mode];for(let s=0;s<r.length;s++){let e,t;if(n.isString(r[s])&&(e="e"===r[s][0]?o.cond[r[s].substring(1)]:o.cond[o.pair[r[s]][0]],t="e"===r[s][0]?this.algorithms.get(r[s].substring(1)):o.act[o.pair[r[s]][1]]),e(i))return t(i),i}throw new Error("error:functionAgreement")}};class u extends l{constructor(e,t){super(e,{name:"add",mode:t}),this.operations.b=["eb(int,int)"],this.algorithms.set("b(int,int)",e=>{e.bs(this.lime.build("integer")(e.left.value+e.right.value))})}}class h extends l{constructor(e,t){super(e,{name:"multiply",mode:t}),this.operations.b=["eb(int,int)"],this.algorithms.set("b(int,int)",e=>{e.bs(this.lime.build("integer")(e.left.value*e.right.value))})}}class c extends l{constructor(e,t){super(e,{name:"subtract",mode:t}),this.operations.b=["eb(int,int)"],this.algorithms.set("b(int,int)",e=>{e.bs(this.lime.build("integer")(e.left.value-e.right.value))})}}var d=s,p=u,m=h,b=c,g=class{constructor(e,t){this.lime=e,this.input=t,this.solution=[]}get steps(){return this.solution.length}get result(){return this.solution[this.steps-1].data}record(e){this.solution.push(e)}},f=class{constructor(e,t,s){this.lime=e,this.data=n.isArray(t)?t:[],this.pos=n.isNumber(s)&&0<=s&&s<this.data.length?s:-1,this.timestamp=Date.now()}get left(){return this.data[this.pos-1]}get func(){return this.data[this.pos]}get right(){return this.data[this.pos+1]}lpi(...e){return this.lime.identify(...e)(this.left)}fi(...e){return this.lime.identify(...e)(this.func)}rpi(...e){return this.lime.identify(...e)(this.right)}bpi(...e){return this.lime.identify(...e)(this.left,this.right)}lps(e){this.data.splice(this.pos-1,1,e)}fs(e){this.data.splice(this.pos,1,e)}rps(e){this.data.splice(this.pos+1,1,e)}lus(e){this.data.splice(this.pos-1,2,e)}rus(e){this.data.splice(this.pos,2,e)}bs(e){this.data.splice(this.pos-1,3,e)}ns(e,t){this.data.splice(this.pos,e,t)}},v=class{constructor(e,t,s){this.lime=e,this.type=["integer","whitespace","symbol","variable"].includes(t)?t:"symbol",this.value=n.isString(s)?s:""}};const y=new Map;y.set("integer",d),y.set("add",p),y.set("multiply",m),y.set("subtract",b),y.set("equation",g),y.set("expression",e),y.set("function",l),y.set("step",f),y.set("token",v);var w=y;class k{constructor(e){this.config={...t,...e},this.module=w,this.flags={},this.constants={},this.variables={ans:void 0},this.memory=[]}get answer(){return this.print(this.variables.ans)}prompt(e){try{if(!n.isString(e))throw new Error("error:inputNotString");if(0===e.length)throw new Error("error:inputEmpty");var t=this.build("equation")(e);return this.lex(t),this.memory.push(t),[this.variables.ans]=t.result,this.answer}catch(e){return this.message(e)}}message(e){var t=new Error("issue:invalidMessage");if(!r.hasOwnProperty(e.message)||!e.message.includes(":"))return console.log(e),this.message(t);var s=e.message.split(":");let i;switch(s[0]){case"error":i="!";break;case"warn":i="?";break;case"issue":i="i";break;default:return this.message(t)}return`[${i}] ${s[1]}\n${r[e.message]} ${"i"===i?`\n${r.github}`:""}`}lex(e){const s=e.input,i=[];for(let t=0;t<s.length;t++){const r=s[t];let e=r;if(r.match(/\s/))i.push(this.build("token")("whitespace"));else if(r.match(/\d/)){for(;t+1<s.length&&s[t+1].match(/\d/);)e+=s[++t];i.push(this.build("token")("integer",e))}else if(r.match(/\w/)){for(;t+1<s.length&&s[t+1].match(/\w/);)e+=s[++t];i.push(this.build("token")("variable",e))}else i.push(this.build("token")("symbol",e))}e.record(i),this.parse(e)}parse(e){const t=e.solution.shift(),s=[];for(let e=0;e<t.length;e++)switch(t[e].type){case"whitespace":break;case"integer":s.push(this.build("integer")(t[e].value));break;case"symbol":case"variable":if(i.hasOwnProperty(t[e].value))s.push(this.refer(t[e].value));else{if("variable"!==t[e].type)throw new Error("error:invalidSymbol");s.push(this.build("variable")(t[e].value))}break;default:throw new Error("issue:invalidTokenInParse")}e.record(this.build("step")(s)),this.process(e)}process(s){for(;;){let t=-1;for(let e=0;e<s.result.length;e++)this.identify("function")(s.result[e])&&(t=t<0||s.result[e].order>s.result[t].order?e:t);if(t<0)break;var e=this.build("step")(s.result,t);s.record(s.result[t].evaluate(e))}}print(e){if(this.identify("integer")(e))return`${e.value}`;throw new Error("issue:invalidExpressionInPrint")}identify(...s){return(...e)=>e.every(t=>s.some(e=>n.isClass(this.module.get(e),t)))}build(t){if(this.module.has(t))return(...e)=>new(this.module.get(t))(this,...e);throw new Error("issue:invalidModuleInBuild")}refer(e){return n.isNumber(e)?this.build("integer")(e):i.hasOwnProperty(e)?this.build(i[e][0])(...i[e].slice(1).map(e=>n.isArray(e)?this.build(e[0])(...e.slice(1)):e)):void 0}}return e=>new k(e)});
