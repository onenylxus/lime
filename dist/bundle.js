/*
Lime version 0.1.1
Mathematics computation engine
2021 Lime Project Team, MIT license
https://github.com/onenylxus/lime
*/

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Lime=e()}(this,function(){"use strict";var s={github:"Please create a GitHub issue about how you received this message, thank you. ","error:invalidParametersInCommand":"Invalid parameters in command.","error:functionAgreement":"Function does not agree with parameter types.","error:inputEmptyInDirect":"Direct input is empty.","error:inputEmptyInPrompt":"Prompt input is empty.","error:inputNotArrayInDirect":"Direct input is not an array.","error:inputNotStringInPrompt":"Prompt input is not a string.","error:invalidSymbol":"Invalid symbol in prompt input.","error:negativeFactorial":"Factorial function has negative integer input. Currenly gamma function has not been implemented.","error:undefinedVariable":"Variable is undefined but used.","error:unmatchedBrackets":"Some brackets are unmatched.","issue:invalidExpressionInConstruct":"Invalid expression in constructor.","issue:invalidFunctionOrder":"Invalid function order.","issue:invalidMessage":"Invalid message detected.","issue:invalidModuleInBuild":"Invalid module in build function.","issue:invalidModuleInIdentify":"Invalid module in identify function.","issue:invalidResultLengthInProcess":"Invalid result length in process function.","issue:invalidTokenInParse":"Invalid token in parse function."},r={about:["about"],help:["help"],true:["boolean",!0],false:["boolean",!1],"+":["add","b"],"=":["assign","b"],"&":["bitwiseAnd","b"],"~":["bitwiseNot","r"],"|":["bitwiseOr","b"],"(":["commonBracket","n"],")":["commonBracket","x"],".":["decimal","b"],"/":["divide","b"],"==":["equal","b"],"^":["exponent","b"],"!":["factorial","l"],">":["greater","b"],">=":["greaterEqual","b"],"&&":["logicalAnd","b"],"_!":["logicalNot","r"],"||":["logicalOr","b"],"%":["modulo","b"],"*":["multiply","b"],"_-":["negative","r"],"!=":["notEqual","b"],"_+":["positive","r"],"<<":["shiftLeft","b"],">>":["shiftRight","b"],"<":["smaller","b"],"<=":["smallerEqual","b"],"-":["subtract","b"]};var e={developmentMode:!1,testMode:!1},i={name:"@onenylxus/lime",version:"0.1.1",description:"Mathematics computation engine",author:"Lime Project Team",license:"MIT",main:"dist/bundle.js",module:"dist/bundle-cjs.js",browser:"dist/bundle-esm.js",sideEffects:!1,dependencies:{},devDependencies:{"@rollup/plugin-commonjs":"^18.1.0","@rollup/plugin-json":"^4.1.0","@rollup/plugin-node-resolve":"^13.0.0",codecov:"^3.8.2",eslint:"^7.25.0","eslint-config-airbnb-base":"^14.2.1","eslint-plugin-import":"^2.22.1",husky:"^6.0.0",jest:"^26.6.3","lint-staged":"^10.5.4","prettier-eslint":"^12.0.0","prettier-eslint-cli":"^5.0.1",rimraf:"^3.0.2",rollup:"^2.47.0","rollup-plugin-node-polyfills":"^0.2.1","rollup-plugin-uglify":"^5.0.2"},scripts:{lint:"prettier-eslint '**/*.js'",clean:"rimraf dist/*.js",debug:"node examples/prompt.js -q",prebuild:"yarn lint && yarn clean",build:"rollup -c",watch:"jest --config jest.config.json --watch",pretest:"yarn build",test:"jest --config jest.config.json --verbose"},husky:{hooks:{"pre-commit":"yarn test"}},repository:{type:"git",url:"git+https://github.com/onenylxus/lime.git"},bugs:{url:"https://github.com/onenylxus/lime/issues"},homepage:"https://github.com/onenylxus/lime#readme"};var a=function(){const t=i;return`Lime version ${t.version}\n${t.description}\n2021 ${t.author}, ${t.license} license\n${t.homepage.slice(0,-7)}`},l=class{constructor(t,{...e}){this.lime=t,this.name=e.hasOwnProperty("name")?e.name:this.constructor.name.slice(11),this.description=e.hasOwnProperty("description")?e.description:"",this.operations=new Map}execute(t){var e=t.split(/\s/).slice(1),t=e.length;if(!this.operations.has(t))throw new Error("error:invalidParametersInCommand");return this.operations.get(t)(...e)}};class t extends l{constructor(t){super(t,{name:"about",description:"shows information about the engine"}),this.operations.set(0,()=>a())}}class n extends l{constructor(t){super(t,{name:"help",description:"list all available commands"}),this.operations.set(0,()=>{const i=["Below is a list of available commands:"];return this.lime.module.forEach(t=>{try{var e=new t(this.lime);e instanceof l&&i.push(`${e.name}: ${e.description}`)}catch(t){}}),i.join("\n")})}}var o=class{static isUndefined(...t){return t.every(t=>void 0===t)}static isNull(...t){return t.every(t=>null===t)}static isTrue(...t){return t.every(t=>!0===t)}static isFalse(...t){return t.every(t=>!1===t)}static isBoolean(...t){return t.every(t=>"boolean"==typeof t)}static isNumber(...t){return t.every(t=>"number"==typeof t)}static isString(...t){return t.every(t=>"string"==typeof t)}static isFunction(...t){return t.every(t=>"function"==typeof t)}static isArray(...t){return t.every(t=>t instanceof Array)}static isObject(...t){return t.every(t=>t instanceof Object)}static isClass(e,...t){return t.every(t=>t instanceof e)}};var h=class{constructor(t,{...e}){this.lime=t,this.isSimple=!e.hasOwnProperty("isSimple")||!o.isBoolean(e.isSimple)||e.isSimple}};class c extends h{constructor(t,e){super(t,{isSimple:!0}),this.raw=e}get value(){return!!this.raw}toInteger(){return this.value?this.lime.direct([1]):this.lime.direct([0])}toRational(){return this.toInteger().toRational()}simplify(){return this.lime.build("boolean")(this.value)}print(){return this.value?"true":"false"}}class u extends h{constructor(t,e){if(super(t,{isSimple:!0}),!o.isNumber(+e))throw new Error("issue:invalidExpressionInConstruct");this.string=`${e}`}get value(){return Math.trunc(+this.string)}toRational(){return this.lime.build("rational")(this,this.lime.build("integer")(1))}simplify(){return this.lime.build("integer")(this.value)}print(){return`${this.value}`}}class m extends h{constructor(t,e,i){if(super(t,{isSimple:!0}),!this.lime.identify("integer")(e,i))throw new Error("issue:invalidExpressionInConstruct");this.nPlace=e,this.dPlace=i}get value(){return{n:this.nPlace.value,d:this.dPlace.value}}simplify(){return this.value.d<0&&(this.nPlace=this.lime.direct(["-",this.nPlace]),this.dPlace=this.lime.direct(["-",this.dPlace])),1===this.value.d?this.nPlace.simplify():this.lime.build("rational")(this.nPlace.simplify(),this.dPlace.simplify())}print(){return`${this.value.n}/${this.value.d}`}}class d extends h{constructor(t,e){super(t,{isSimple:!0}),this.key=e}get value(){if(!this.lime.variables.has(this.key))throw new Error("error:undefinedVariable");return this.lime.variables.get(this.key)}simplify(){return this.value.simplify()}}var p=[["assign","equal","greater","greaterEqual","notEqual","smaller","smallerEqual"],["add","bitwiseAnd","bitwiseNot","bitwiseOr","logicalAnd","logicalNot","logicalOr","modulo","shiftLeft","shiftRight","subtract"],["divide","multiply"],["exponent"],["decimal","negative","positive"],["factorial"],["commonBracket"]],b={cond:{"b(bool,bool)":t=>t.bpi("boolean"),"b(int,int)":t=>t.bpi("integer"),"b(int,rat)":t=>t.lpi("integer")&&t.rpi("rational"),"b(rat,int)":t=>t.lpi("rational")&&t.rpi("integer"),"b(rat,rat)":t=>t.bpi("rational"),"b(var,exp)":t=>t.lpi("variable")&&t.rpi("expression"),"l(int)":t=>t.lpi("integer"),"l(var)":t=>t.lpi("variable"),"n()":()=>!0,"r(bool)":t=>t.rpi("boolean"),"r(int)":t=>t.rpi("integer"),"r(rat)":t=>t.rpi("rational"),"r(var)":t=>t.rpi("variable"),"r(+)":t=>t.rpi("add"),"r(=)":t=>t.rpi("assign"),"r(&)":t=>t.rpi("bitwiseAnd"),"r(|)":t=>t.rpi("bitwiseOr"),"r(!)":t=>t.rpi("factorial"),"r(>)":t=>t.rpi("greater"),"r(_-)":t=>t.rpi("negative"),"r(_+)":t=>t.rpi("positive"),"r(<)":t=>t.rpi("smaller"),"r(-)":t=>t.rpi("subtract"),"z()":t=>0===t.pos},act:{"f(==)":t=>{t.rus(t.lime.refer("=="))},"f(!==)":t=>{t.rus(t.lime.refer("!"),t.lime.refer("=="))},"f(>=)":t=>{t.rus(t.lime.refer(">="))},"f(&&)":t=>{t.rus(t.lime.refer("&&"))},"f(_!)":t=>{t.fs(t.lime.refer("_!"))},"f(||)":t=>{t.rus(t.lime.refer("||"))},"f(_-)":t=>{t.fs(t.lime.refer("_-"))},"f(!=)":t=>{t.rus(t.lime.refer("!="))},"f(_+)":t=>{t.fs(t.lime.refer("_+"))},"f(<<)":t=>{t.rus(t.lime.refer("<<"))},"f(>>)":t=>{t.rus(t.lime.refer(">>"))},"f(<=)":t=>{t.rus(t.lime.refer("<="))},"l(int->rat)":t=>{t.lps(t.left.toRational())},"l(var->exp)":t=>{t.lps(t.left.value)},"r(int->rat)":t=>{t.rps(t.right.toRational())},"r(var->exp)":t=>{t.rps(t.right.value)},"r(_!)":t=>{t.rps(t.lime.refer("_!"))},"r(_-)":t=>{t.rps(t.lime.refer("_-"))},"r(_+)":t=>{t.rps(t.lime.refer("_+"))}},pair:{"cb(int->rat,rat)":["b(int,rat)","l(int->rat)"],"cb(rat,int->rat)":["b(rat,int)","r(int->rat)"],"cl(var->exp)":["l(var)","l(var->exp)"],"cr(var->exp)":["r(var)","r(var->exp)"],"tf(==)":["r(=)","f(==)"],"tf(!==)":["r(=)","f(!==)"],"tf(>=)":["r(=)","f(>=)"],"tf(&&)":["r(&)","f(&&)"],"tf(||)":["r(|)","f(||)"],"tf(!=)":["r(=)","f(!=)"],"tf(<<)":["r(<)","f(<<)"],"tf(>>)":["r(>)","f(>>)"],"tf(<=)":["r(=)","f(<=)"],"tr(_!)":["r(!)","r(_!)"],"tr(_+)":["r(+)","r(_+)"],"tr(_-)":["r(-)","r(_-)"],"tz(_!)":["z()","f(_!)"],"tz(_+)":["z()","f(_+)"],"tz(_-)":["z()","f(_-)"]}};var g=class{constructor(t,{...e}){this.lime=t,this.mode=e.hasOwnProperty("mode")&&["l","r","b","n"].includes(e.mode)?e.mode:"x",this.name=e.hasOwnProperty("name")?e.name:this.constructor.name.slice(12),this.operations={l:[],r:[],b:[],n:[]},this.algorithms=new Map}get order(){for(let t=0;t<p.length;t++)if(p[t].includes(this.name))return t;throw new Error("issue:invalidFunctionOrder")}evaluate(r){if("x"===this.mode)throw new Error("error:unmatchedBrackets");const s=this.operations[this.mode];for(let i=0;i<s.length;i++){let t,e;if(o.isString(s[i])&&(t="e"===s[i][0]?b.cond[s[i].substring(1)]:b.cond[b.pair[s[i]][0]],e="e"===s[i][0]?this.algorithms.get(s[i].substring(1)):b.act[b.pair[s[i]][1]]),t(r))return e(r),r}throw new Error("error:functionAgreement")}};class f extends g{constructor(t,e){super(t,{name:"add",mode:e}),this.operations.b=["tz(_+)","tr(_!)","tr(_+)","tr(_-)","cb(int->rat,rat)","cb(rat,int->rat)","cl(var->exp)","cr(var->exp)","eb(int,int)","eb(rat,rat)"],this.algorithms.set("b(int,int)",t=>{t.bs(this.lime.build("integer")(t.left.value+t.right.value))}),this.algorithms.set("b(rat,rat)",t=>{t.bs(this.lime.build("rational")(this.lime.direct([t.left.nPlace,"*",t.right.dPlace,"+",t.right.nPlace,"*",t.left.dPlace]),this.lime.direct([t.left.dPlace,"*",t.right.dPlace])))})}}class v extends g{constructor(t,e){super(t,{name:"decimal",mode:e}),this.operations.b=["eb(int,int)"],this.algorithms.set("b(int,int)",t=>{var e;0<t.right.value?(e=this.lime.direct([10,"^",t.right.string.length]),t.bs(this.lime.direct(["(",t.left,"*",e,"+",t.right,")","/",e]))):t.bs(t.left)})}}class _ extends g{constructor(t,e){super(t,{name:"divide",mode:e}),this.operations.b=["tr(_!)","tr(_+)","tr(_-)","cb(int->rat,rat)","cb(rat,int->rat)","cl(var->exp)","cr(var->exp)","eb(int,int)","eb(rat,rat)"],this.algorithms.set("b(int,int)",t=>{t.left.value%t.right.value==0?t.bs(this.lime.build("integer")(t.left.value/t.right.value)):t.bs(this.lime.build("rational")(t.left,t.right))}),this.algorithms.set("b(rat,rat)",t=>{t.bs(this.lime.build("rational")(this.lime.direct([t.left.nPlace,"*",t.right.dPlace]),this.lime.direct([t.left.dPlace,"*",t.right.nPlace])))})}}class x extends g{constructor(t,e){super(t,{name:"exponent",mode:e}),this.operations.b=["tr(_!)","tr(_+)","tr(_-)","cl(var->exp)","cr(var->exp)","eb(int,int)","eb(rat,int)"],this.algorithms.set("b(int,int)",t=>{0<=t.right.value?t.bs(this.lime.build("integer")(t.left.value**t.right.value)):t.bs(this.lime.build("rational")(this.lime.direct([1]),this.lime.direct([t.left,"^","-",t.right])))}),this.algorithms.set("b(rat,int)",t=>{0<=t.right.value?t.bs(this.lime.build("rational")(this.lime.direct([t.left.nPlace,"^",t.right]),this.lime.direct([t.left.dPlace,"^",t.right]))):t.bs(this.lime.build("rational")(this.lime.direct([t.left.dPlace,"^","-",t.right]),this.lime.direct([t.left.nPlace,"^","-",t.right])))})}}class y extends g{constructor(t,e){super(t,{name:"modulo",mode:e}),this.operations.b=["tr(_!)","tr(_+)","tr(_-)","cl(var->exp)","cr(var->exp)","eb(int,int)"],this.algorithms.set("b(int,int)",t=>{t.bs(this.lime.build("integer")(t.left.value%t.right.value))})}}class w extends g{constructor(t,e){super(t,{name:"multiply",mode:e}),this.operations.b=["tr(_!)","tr(_+)","tr(_-)","cb(int->rat,rat)","cb(rat,int->rat)","cl(var->exp)","cr(var->exp)","eb(int,int)","eb(rat,rat)"],this.algorithms.set("b(int,int)",t=>{t.bs(this.lime.build("integer")(t.left.value*t.right.value))}),this.algorithms.set("b(rat,rat)",t=>{t.bs(this.lime.build("rational")(this.lime.direct([t.left.nPlace,"*",t.right.nPlace]),this.lime.direct([t.left.dPlace,"*",t.right.dPlace])))})}}class P extends g{constructor(t,e){super(t,{name:"negative",mode:e}),this.operations.r=["tr(_!)","tr(_+)","tr(_-)","cr(var->exp)","er(int)","er(rat)","er(_+)","er(_-)"],this.algorithms.set("r(int)",t=>{t.rus(this.lime.direct([-1,"*",t.right]))}),this.algorithms.set("r(rat)",t=>{t.rus(this.lime.build("rational")(this.lime.direct(["-",t.right.nPlace]),t.right.dPlace))}),this.algorithms.set("r(_+)",t=>{t.rus(this.lime.refer("_-"))}),this.algorithms.set("r(_-)",t=>{t.rus(this.lime.refer("_+"))})}}class E extends g{constructor(t,e){super(t,{name:"positive",mode:e}),this.operations.r=["tr(_!)","tr(_+)","tr(_-)","cr(var->exp)","er(int)","er(rat)","er(_+)","er(_-)"],this.algorithms.set("r(int)",t=>{t.rus(this.lime.direct([1,"*",t.right]))}),this.algorithms.set("r(rat)",t=>{t.rus(this.lime.build("rational")(this.lime.direct([t.right.nPlace]),t.right.dPlace))}),this.algorithms.set("r(_+)",t=>{t.rus(this.lime.refer("_+"))}),this.algorithms.set("r(_-)",t=>{t.rus(this.lime.refer("_-"))})}}class I extends g{constructor(t,e){super(t,{name:"subtract",mode:e}),this.operations.b=["tz(_-)","tr(_!)","tr(_+)","tr(_-)","cb(int->rat,rat)","cb(rat,int->rat)","cl(var->exp)","cr(var->exp)","eb(int,int)","eb(rat,rat)"],this.algorithms.set("b(int,int)",t=>{t.bs(this.lime.build("integer")(t.left.value-t.right.value))}),this.algorithms.set("b(rat,rat)",t=>{t.bs(this.lime.build("rational")(this.lime.direct([t.left.nPlace,"*",t.right.dPlace,"-",t.right.nPlace,"*",t.left.dPlace]),this.lime.direct([t.left.dPlace,"*",t.right.dPlace])))})}}class k extends g{constructor(t,e){super(t,{name:"bitwiseAnd",mode:e}),this.operations.b=["tf(&&)","tr(_!)","tr(_+)","tr(_-)","cl(var->exp)","cr(var->exp)","eb(int,int)"],this.algorithms.set("b(int,int)",t=>{t.bs(this.lime.direct([t.left.value&t.right.value]))})}}class j extends g{constructor(t,e){super(t,{name:"bitwiseNot",mode:e}),this.operations.r=["tr(_!)","tr(_+)","tr(_-)","cr(var->exp)","er(int)"],this.algorithms.set("r(int)",t=>{t.rus(this.lime.direct([~t.right.value]))})}}class O extends g{constructor(t,e){super(t,{name:"bitwiseOr",mode:e}),this.operations.b=["tf(||)","tr(_!)","tr(_+)","tr(_-)","cl(var->exp)","cr(var->exp)","eb(int,int)"],this.algorithms.set("b(int,int)",t=>{t.bs(this.lime.direct([t.left.value|t.right.value]))})}}class q extends g{constructor(t,e){super(t,{name:"shiftLeft",mode:e}),this.operations.b=["tr(_!)","tr(_+)","tr(_-)","cl(var->exp)","cr(var->exp)","eb(int,int)"],this.algorithms.set("b(int,int)",t=>{t.bs(this.lime.direct([t.left.value<<t.right.value]))})}}class A extends g{constructor(t,e){super(t,{name:"shiftRight",mode:e}),this.operations.b=["tr(_!)","tr(_+)","tr(_-)","cl(var->exp)","cr(var->exp)","eb(int,int)"],this.algorithms.set("b(int,int)",t=>{t.bs(this.lime.direct([t.left.value>>t.right.value]))})}}class N extends g{constructor(t,e){super(t,{name:"equal",mode:e}),this.operations.b=["tr(_!)","tr(_+)","tr(_-)","cb(int->rat,rat)","cb(rat,int->rat)","cl(var->exp)","cr(var->exp)","eb(int,int)","eb(rat,rat)"],this.algorithms.set("b(int,int)",t=>{t.bs(this.lime.build("boolean")(t.left.value===t.right.value))}),this.algorithms.set("b(rat,rat)",t=>{t.bs(this.lime.direct([t.left.nPlace,"*",t.right.dPlace,"==",t.right.nPlace,"*",t.left.dPlace]))})}}class S extends g{constructor(t,e){super(t,{name:"greater",mode:e}),this.operations.b=["tf(>=)","tf(>>)","tr(_!)","tr(_+)","tr(_-)","cb(int->rat,rat)","cb(rat,int->rat)","cl(var->exp)","cr(var->exp)","eb(int,int)","eb(rat,rat)"],this.algorithms.set("b(int,int)",t=>{t.bs(this.lime.build("boolean")(t.left.value>t.right.value))}),this.algorithms.set("b(rat,rat)",t=>{t.bs(this.lime.direct([t.left.nPlace,"*",t.right.dPlace,">",t.right.nPlace,"*",t.left.dPlace]))})}}class M extends g{constructor(t,e){super(t,{name:"greaterEqual",mode:e}),this.operations.b=["tr(_!)","tr(_+)","tr(_-)","cb(int->rat,rat)","cb(rat,int->rat)","cl(var->exp)","cr(var->exp)","eb(int,int)","eb(rat,rat)"],this.algorithms.set("b(int,int)",t=>{t.bs(this.lime.build("boolean")(t.left.value>=t.right.value))}),this.algorithms.set("b(rat,rat)",t=>{t.bs(this.lime.direct([t.left.nPlace,"*",t.right.dPlace,">=",t.right.nPlace,"*",t.left.dPlace]))})}}class $ extends g{constructor(t,e){super(t,{name:"notEqual",mode:e}),this.operations.b=["tf(!==)","tr(_!)","tr(_+)","tr(_-)","cb(int->rat,rat)","cb(rat,int->rat)","cl(var->exp)","cr(var->exp)","eb(int,int)","eb(rat,rat)"],this.algorithms.set("b(int,int)",t=>{t.bs(this.lime.build("boolean")(t.left.value!==t.right.value))}),this.algorithms.set("b(rat,rat)",t=>{t.bs(this.lime.direct([t.left.nPlace,"*",t.right.dPlace,"!=",t.right.nPlace,"*",t.left.dPlace]))})}}class B extends g{constructor(t,e){super(t,{name:"smaller",mode:e}),this.operations.b=["tf(<=)","tf(<<)","tr(_!)","tr(_+)","tr(_-)","cb(int->rat,rat)","cb(rat,int->rat)","cl(var->exp)","cr(var->exp)","eb(int,int)","eb(rat,rat)"],this.algorithms.set("b(int,int)",t=>{t.bs(this.lime.build("boolean")(t.left.value<t.right.value))}),this.algorithms.set("b(rat,rat)",t=>{t.bs(this.lime.direct([t.left.nPlace,"*",t.right.dPlace,"<",t.right.nPlace,"*",t.left.dPlace]))})}}class R extends g{constructor(t,e){super(t,{name:"smallerEqual",mode:e}),this.operations.b=["tr(_!)","tr(_+)","tr(_-)","cb(int->rat,rat)","cb(rat,int->rat)","cl(var->exp)","cr(var->exp)","eb(int,int)","eb(rat,rat)"],this.algorithms.set("b(int,int)",t=>{t.bs(this.lime.build("boolean")(t.left.value<=t.right.value))}),this.algorithms.set("b(rat,rat)",t=>{t.bs(this.lime.direct([t.left.nPlace,"*",t.right.dPlace,"<=",t.right.nPlace,"*",t.left.dPlace]))})}}class z extends g{constructor(t,e){super(t,{name:"factorial",mode:e}),this.operations.l=["tz(_!)","tf(!=)","cl(var->exp)","el(int)"],this.algorithms.set("l(int)",t=>{if(t.left.value<0)throw new Error("error:negativeFactorial");0<t.left.value?t.lus(this.lime.direct([t.left,"*","(",t.left,"-",1,")","!"])):t.lus(this.lime.direct([1]))})}}class L extends g{constructor(t,e){super(t,{name:"logicalAnd",mode:e}),this.operations.b=["tr(_!)","tr(_+)","tr(_-)","cl(var->exp)","cr(var->exp)","eb(bool,bool)"],this.algorithms.set("b(bool,bool)",t=>{t.bs(this.lime.build("boolean")(t.left.value&&t.right.value))})}}class C extends g{constructor(t,e){super(t,{name:"logicalNot",mode:e}),this.operations.r=["tr(_!)","tr(_+)","tr(_-)","cr(var->exp)","er(bool)"],this.algorithms.set("r(bool)",t=>{t.rus(this.lime.build("boolean")(!t.right.value))})}}class D extends g{constructor(t,e){super(t,{name:"logicalOr",mode:e}),this.operations.b=["tr(_!)","tr(_+)","tr(_-)","cl(var->exp)","cr(var->exp)","eb(bool,bool)"],this.algorithms.set("b(bool,bool)",t=>{t.bs(this.lime.build("boolean")(t.left.value||t.right.value))})}}class F extends g{constructor(t,e){super(t,{name:"assign",mode:e}),this.operations.b=["tf(==)","tr(_+)","tr(_-)","cr(var->exp)","eb(var,exp)"],this.algorithms.set("b(var,exp)",t=>{this.lime.variables.set(t.left.key,t.right),t.bs(t.left)})}}class T extends g{constructor(t,e){super(t,{name:"commonBracket",mode:e}),this.operations.n=["en()"],this.algorithms.set("n()",t=>{const e=t["data"],i=[];let r=t.pos,s=0;for(;r+1<e.length&&!(this.lime.identify("commonBracket")(e[r+1])&&(s+="n"===e[r+1].mode?1:-1,s<0));)i.push(e[++r]);if(0<=s)throw new Error("error:unmatchedBrackets");t.ns(i.length+2,this.lime.direct([...i]))})}}var V=t,U=n,G=c,H=u,J=m,K=d,Q=f,W=v,X=_,Y=x,Z=y,tt=w,et=P,it=E,rt=I,st=k,at=j,lt=O,nt=q,ot=A,ht=N,ct=S,ut=M,mt=$,dt=B,pt=R,bt=z,gt=L,ft=C,vt=D,_t=F,xt=T,yt=class{constructor(t,e){this.lime=t,this.input=e,this.solution=[]}get steps(){return this.solution.length}get result(){return this.solution[this.steps-1].data}record(t){this.solution.push(t)}},wt=class{constructor(t,e,i){this.lime=t,this.data=o.isArray(e)?e:[],this.pos=o.isNumber(i)&&0<=i&&i<this.data.length?i:-1,this.timestamp=Date.now()}get left(){return this.data[this.pos-1]}get func(){return this.data[this.pos]}get right(){return this.data[this.pos+1]}lpi(...t){return this.lime.identify(...t)(this.left)}fi(...t){return this.lime.identify(...t)(this.func)}rpi(...t){return this.lime.identify(...t)(this.right)}bpi(...t){return this.lime.identify(...t)(this.left,this.right)}lps(...t){this.data.splice(this.pos-1,1,...t)}fs(...t){this.data.splice(this.pos,1,...t)}rps(...t){this.data.splice(this.pos+1,1,...t)}lus(...t){this.data.splice(this.pos-1,2,...t)}rus(...t){this.data.splice(this.pos,2,...t)}bs(...t){this.data.splice(this.pos-1,3,...t)}ns(t,...e){this.data.splice(this.pos,t,...e)}},Pt=class{constructor(t,e,i){this.lime=t,this.type=["integer","whitespace","symbol","variable"].includes(e)?e:"symbol",this.value=o.isString(i)?i:""}};const Et=new Map;Et.set("about",V),Et.set("help",U),Et.set("boolean",G),Et.set("integer",H),Et.set("rational",J),Et.set("variable",K),Et.set("add",Q),Et.set("decimal",W),Et.set("divide",X),Et.set("exponent",Y),Et.set("modulo",Z),Et.set("multiply",tt),Et.set("negative",et),Et.set("positive",it),Et.set("subtract",rt),Et.set("bitwiseAnd",st),Et.set("bitwiseNot",at),Et.set("bitwiseOr",lt),Et.set("shiftLeft",nt),Et.set("shiftRight",ot),Et.set("equal",ht),Et.set("greater",ct),Et.set("greaterEqual",ut),Et.set("notEqual",mt),Et.set("smaller",dt),Et.set("smallerEqual",pt),Et.set("factorial",bt),Et.set("logicalAnd",gt),Et.set("logicalNot",ft),Et.set("logicalOr",vt),Et.set("assign",_t),Et.set("commonBracket",xt),Et.set("command",l),Et.set("equation",yt),Et.set("expression",h),Et.set("function",g),Et.set("step",wt),Et.set("token",Pt);var It=Et;class kt{constructor(t){this.config={...e,...t},this.module=It,this.variables=new Map,this.memory=[]}get answer(){return this.variables.get("ans").print()}prompt(t){try{if(!o.isString(t))throw new Error("error:inputNotStringInPrompt");if(0===t.length)throw new Error("error:inputEmptyInPrompt");const e=this.build("equation")(t);return(this.lex(e),this.identify("command")(e.result[0]))?e.result[0].execute(t):(this.memory.push(e),this.variables.set("ans",e.result[0]),this.answer)}catch(t){return this.message(t)}}direct(t){try{if(!o.isArray(t))throw new Error("error:inputNotArrayInDirect");if(0===t.length)throw new Error("error:inputEmptyInDirect");const e=this.build("equation")(t);return e.record(this.build("step")(e.input.map(t=>!o.isString(t)&&!o.isNumber(t)||o.isUndefined(this.refer(t))?t:this.refer(t)))),this.process(e),e.result[0]}catch(t){return this.message(t)}}message(t){var e=new Error("issue:invalidMessage");if(!s.hasOwnProperty(t.message)||!t.message.includes(":"))return console.log(t),this.message(e);var i=t.message.split(":");let r;switch(i[0]){case"error":r="!";break;case"warn":r="?";break;case"issue":r="i";break;default:return this.message(e)}return this.config.developmentMode&&"i"===r&&console.log(t),`[${r}] ${i[1]}\n${s[t.message]} ${"i"===r?`\n${s.github}`:""}`}lex(t){const i=t.input,r=[];for(let e=0;e<i.length;e++){const s=i[e];let t=s;if(s.match(/\s/))r.push(this.build("token")("whitespace"));else if(s.match(/\d/)){for(;e+1<i.length&&i[e+1].match(/\d/);)t+=i[++e];r.push(this.build("token")("integer",t))}else if(s.match(/\w/)){for(;e+1<i.length&&i[e+1].match(/\w/);)t+=i[++e];r.push(this.build("token")("variable",t))}else r.push(this.build("token")("symbol",t))}t.record(r),this.parse(t)}parse(t){const e=t.solution.shift(),i=[];for(let t=0;t<e.length;t++)switch(e[t].type){case"whitespace":break;case"integer":i.push(this.build("integer")(e[t].value));break;case"symbol":case"variable":if(r.hasOwnProperty(e[t].value))i.push(this.refer(e[t].value));else{if("variable"!==e[t].type)throw new Error("error:invalidSymbol");i.push(this.build("variable")(e[t].value))}break;default:throw new Error("issue:invalidTokenInParse")}t.record(this.build("step")(i)),this.identify("command")(t.result[0])||this.process(t)}process(i){for(;;){let e=-1;for(let t=0;t<i.result.length;t++)this.identify("function")(i.result[t])&&(e=e<0||i.result[t].order>i.result[e].order?t:e);if(e<0)break;var t=this.build("step")(i.result,e);i.record(i.result[e].evaluate(t))}if(1!==i.result.length)throw new Error("issue:invalidResultLengthInProcess");i.record(this.build("step")([i.result[0].simplify()]))}identify(...i){if(i.every(t=>this.module.has(t)))return(...t)=>t.every(e=>i.some(t=>o.isClass(this.module.get(t),e)));throw new Error("issue:invalidModuleInIdentify")}build(e){if(this.module.has(e))return(...t)=>new(this.module.get(e))(this,...t);throw new Error("issue:invalidModuleInBuild")}refer(t){return o.isNumber(t)?this.build("integer")(t):r.hasOwnProperty(t)?this.build(r[t][0])(...r[t].slice(1).map(t=>o.isArray(t)?this.build(t[0])(...t.slice(1)):t)):void 0}}return t=>new kt(t)});
